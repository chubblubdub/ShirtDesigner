<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>T-Shirt Mockup Tool</title>
<style>
  body {
    margin: 0;
    font-family: sans-serif;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    background: #f4f4f4;
    height: 100vh;
  }
  .controls {
    background: white;
    padding: 10px;
    margin: 10px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-width: 250px;
  }
  .mockup-area {
    position: relative;
    background: white;
    border: 2px solid #ccc;
    border-radius: 10px;
    margin: 10px;
    overflow: hidden;
    display: inline-block;
  }
  .mockup-area img {
    display: block;
    max-width: 500px;
    height: auto;
  }
  .overlay {
    position: absolute;
    top: 0; left: 0;
    transform-origin: center;
    cursor: move;
  }
  .transform-box {
    border: 2px dashed #666;
    position: absolute;
    top: 0; left: 0;
    pointer-events: none;
  }
  input[type=range] {
    width: 100%;
  }
</style>
</head>
<body>

<div class="controls">
  <label>T-Shirt Image:</label>
  <input type="file" id="shirtInput" accept="image/*">
  
  <label>Or drag/paste image here</label>
  
  <label>Overlay Design:</label>
  <select id="designSelect">
    <option value="">-- Select --</option>
    <option value="https://raw.githubusercontent.com/chubblubdub/ShirtDesigner/main/smiley.svg">Smiley</option>
    <option value="https://raw.githubusercontent.com/chubblubdub/ShirtDesigner/main/heart.svg">Heart</option>
    <option value="https://raw.githubusercontent.com/chubblubdub/ShirtDesigner/main/squiggle.svg">Squiggle</option>
  </select>
  
  <label>Color:</label>
  <input type="color" id="colorPicker" value="#ff0000">
  
  <label>Scale:</label>
  <input type="range" id="scaleSlider" min="0.1" max="3" step="0.01" value="1">
  
  <button id="centerBtn">Center</button>
</div>

<div class="mockup-area" id="mockupArea">
  <img id="shirtImage" alt="Shirt preview">
  <div class="overlay" id="overlay"></div>
</div>

<script>
const shirtInput = document.getElementById('shirtInput');
const mockupArea = document.getElementById('mockupArea');
const shirtImage = document.getElementById('shirtImage');
const overlay = document.getElementById('overlay');
const designSelect = document.getElementById('designSelect');
const colorPicker = document.getElementById('colorPicker');
const scaleSlider = document.getElementById('scaleSlider');
const centerBtn = document.getElementById('centerBtn');

let currentSVG = null;
let overlayScale = 1;
let offsetX = 0, offsetY = 0;
let isDragging = false;
let dragStartX = 0, dragStartY = 0;

function loadShirt(file) {
  const reader = new FileReader();
  reader.onload = e => {
    shirtImage.src = e.target.result;
    shirtImage.onload = () => {
      mockupArea.style.width = shirtImage.width + "px";
      mockupArea.style.height = shirtImage.height + "px";
    };
  };
  reader.readAsDataURL(file);
}

// Drag & paste support
mockupArea.addEventListener('dragover', e => {
  e.preventDefault();
});
mockupArea.addEventListener('drop', e => {
  e.preventDefault();
  if (e.dataTransfer.files.length) {
    loadShirt(e.dataTransfer.files[0]);
  }
});
document.addEventListener('paste', e => {
  if (e.clipboardData.files.length) {
    loadShirt(e.clipboardData.files[0]);
  }
});

shirtInput.addEventListener('change', e => {
  if (shirtInput.files.length) loadShirt(shirtInput.files[0]);
});

designSelect.addEventListener('change', async () => {
  const url = designSelect.value;
  if (!url) return;
  const res = await fetch(url);
  let svgText = await res.text();
  overlay.innerHTML = svgText;
  currentSVG = overlay.querySelector('svg');
  currentSVG.style.pointerEvents = 'none';
  applyColor(colorPicker.value);
  overlayScale = 1;
  scaleSlider.value = 1;
  overlay.style.transform = `translate(0px,0px) scale(1)`;
  offsetX = 0; offsetY = 0;
});

function applyColor(color) {
  if (!currentSVG) return;
  currentSVG.style.color = color; // for currentColor-based SVGs
  currentSVG.querySelectorAll('*').forEach(el => {
    if (el.hasAttribute('fill') && el.getAttribute('fill').toLowerCase() !== 'none') {
      el.setAttribute('fill', color);
    }
    if (el.hasAttribute('stroke') && el.getAttribute('stroke').toLowerCase() !== 'none') {
      el.setAttribute('stroke', color);
    }
  });
}

colorPicker.addEventListener('input', () => {
  applyColor(colorPicker.value);
});

scaleSlider.addEventListener('input', () => {
  overlayScale = parseFloat(scaleSlider.value);
  overlay.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${overlayScale})`;
});

centerBtn.addEventListener('click', () => {
  if (!currentSVG) return;
  const shirtRect = mockupArea.getBoundingClientRect();
  const svgRect = overlay.getBoundingClientRect();
  offsetX = (shirtRect.width - svgRect.width) / 2;
  offsetY = (shirtRect.height - svgRect.height) / 2;
  overlay.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${overlayScale})`;
});

// Dragging overlay
overlay.addEventListener('mousedown', e => {
  isDragging = true;
  dragStartX = e.clientX - offsetX;
  dragStartY = e.clientY - offsetY;
});
document.addEventListener('mouseup', () => isDragging = false);
document.addEventListener('mousemove', e => {
  if (!isDragging) return;
  offsetX = e.clientX - dragStartX;
  offsetY = e.clientY - dragStartY;
  overlay.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${overlayScale})`;
});
</script>
</body>
</html>
